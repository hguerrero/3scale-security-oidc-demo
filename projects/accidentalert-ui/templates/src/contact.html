<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1">
		
		<title>Shadowman Insurance</title>

		<!-- Loading third party fonts -->
		<link href="http://fonts.googleapis.com/css?family=Roboto+Condensed:300,400,700|" rel="stylesheet" type="text/css">
		<link href="assets/fonts/font-awesome.min.css" rel="stylesheet" type="text/css">
		<link href="assets/fonts/lineo-icon/style.css" rel="stylesheet" type="text/css">

		<!-- Loading main css file -->
		<link rel="stylesheet" href="assets/css/styles.min.css">
		<script src="ENVIRONMENT.KEYCLOAK_URL/auth/js/keycloak.js"></script>		
		<!--[if lt IE 9]>
		<script src="js/ie-support/html5.js"></script>
		<script src="js/ie-support/respond.js"></script>
		<![endif]-->

	</head>


	<body>
		<form id="Contacts">
			<div class="form-group">
				<label for="servicerep" class="required-pf">Your Service Representative:</label>
				<input type="text" class="form-control" name="servicerep" id="servicerep" placeholder="Service Rep">
			</div>
		</form>

		
		<script type="text/javascript">
			var keycloak_url = 'ENVIRONMENT.KEYCLOAK_URL/auth';
			var keycloak_realm = 'ENVIRONMENT.KEYCLOAK_REALM';
			var keycloak_client_id = 'ENVIRONMENT.KEYCLOAK_CLIENT_ID';
			var keycloak_role = 'ENVIRONMENT.KEYCLOAK_ROLE';
			var authentication_option = 'ENVIRONMENT.AUTHENTICATION_OPTION';
				
			console.log('KEYCLOAK_URL: ' + keycloak_url);
			console.log('KEYCLOAK_REALM: ' + keycloak_realm);
			console.log('CLIENT_ID: ' + keycloak_client_id);
			
			
			
			var keyOptions = {
				url: keycloak_url,
				realm: keycloak_realm,
				clientId: keycloak_client_id
			};

			var keycloak = Keycloak(keyOptions);
			console.log('Start initializing Keycloak');			
			keycloak.init({ onLoad: 'check-sso' }).success(function (authenticated) {
				console.log(authenticated ? 'authenticated' : 'not authenticated');	
			}).error(function () {
				alert('Failed to initialize Keycloak!');
			});
				
					
			// call backend
			var servicerep_url = 'ENVIRONMENT.BACKEND_URL/customers/servicerep/'+keycloak.idTokenParsed.name;
			$.ajax({
						type: "get",
						contentType: "application/json",
						headers: {
							'Authorization': 'Bearer ' + keycloak.token
						},
						url: servicerep_url,
						dataType: "json",
						
						success: function (data) {
							console.log('Called back-end successfully!');
							var jsonstring = JSON.parse(data);
							document.getElementById('servicerep').value = jsonstring["servicerep"];
							document.getElementById('servicerep').readOnly = true;
							
						},
						error: function (req, error,errorThrown) {
							alert('Back-end could not be accessed!');
							console.log('Error:' + errorThrown);
						}
			});
		</script>
    </body>

    </html>